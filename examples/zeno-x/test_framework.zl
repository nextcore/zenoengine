// Test: Validation and Response System
// Test the new Laravel-like features

log: "=== Testing Zeno-X Framework Features ==="

// Load framework
include: "bootstrap.zl"

// Test 1: Validation
log: "\n--- Test 1: Validation ---"

var: $testData {
    val: {
        name: "Jo"  // Too short
        email: "invalid-email"  // Invalid format
        age: "abc"  // Not numeric
    }
}

call: 'validate' {
    args: [
        $testData,
        {
            name: 'required|min:3',
            email: 'required|email',
            age: 'numeric|min:18'
        },
        {
            'name.min': 'Name must be at least 3 characters',
            'email.email': 'Please provide a valid email',
            'age.numeric': 'Age must be a number'
        }
    ]
    as: $validator
}

if: $validator.fails {
    then: {
        log: "✅ Validation failed as expected"
        json.encode: $validator.errors { as: $errorsJson }
        log: $errorsJson
    }
} else: {
    log: "❌ Validation should have failed"
}

// Test 2: Valid data
log: "\n--- Test 2: Valid Data ---"

var: $validData {
    val: {
        name: "John Doe"
        email: "john@example.com"
        age: "25"
    }
}

call: 'validate' {
    args: [
        $validData,
        {
            name: 'required|min:3',
            email: 'required|email',
            age: 'numeric'
        },
        {}
    ]
    as: $validator2
}

if: $validator2.passes {
    then: {
        log: "✅ Validation passed as expected"
    }
} else: {
    log: "❌ Validation should have passed"
}

// Test 3: Helper Functions
log: "\n--- Test 3: Helper Functions ---"

call: 'env' {
    args: ['APP_NAME', 'Zeno-X']
    as: $appName
}
log: strings.concat("App Name: ", $appName)

call: 'now' {
    args: []
    as: $timestamp
}
log: strings.concat("Current timestamp: ", $timestamp)

call: 'strRandom' {
    args: [16]
    as: $randomString
}
log: strings.concat("Random string: ", $randomString)

// Test 4: Password Hashing
log: "\n--- Test 4: Password Hashing ---"

var: $password { val: "secret123" }

call: 'hashMake' {
    args: [$password]
    as: $hashed
}
log: strings.concat("Hashed password: ", $hashed)

call: 'hashCheck' {
    args: [$password, $hashed]
    as: $isValid
}

if: $isValid {
    then: {
        log: "✅ Password verification successful"
    }
} else: {
    log: "❌ Password verification failed"
}

log: "\n=== All Tests Completed ==="
